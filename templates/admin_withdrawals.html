<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin | Withdrawals</title>
<link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{background: linear-gradient(135deg,#0a0f2c,#1e3a8a); color:#fff; height:100vh; overflow:hidden;}
.dashboard{display:flex;width:100%;height:100vh;}

/* Sidebar */
.sidebar{
  width:240px;
  background:#0c1f44;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:15px;
  box-shadow:2px 0 8px rgba(0,0,0,0.4);
  transition: transform 0.3s ease;
}
.sidebar h2{text-align:center;margin-bottom:30px;font-size:1.5rem;color:#4fa3ff;}
.sidebar a,.sidebar button{display:block;padding:12px;background:rgba(255,255,255,0.05);margin-bottom:8px;border-radius:6px;color:#fff;text-align:center;border:none;cursor:pointer;transition: all 0.3s ease;}
.sidebar a:hover,.sidebar button:hover{background: rgba(79,163,255,0.3);transform: translateX(4px);}

/* Main Content */
.main-content{flex:1;padding:20px;overflow-y:auto;position:relative;}
.main-content h2{margin-bottom:20px;font-size:1.8rem;animation: fadeIn 0.8s ease forwards;}

/* Table */
.table-wrapper{overflow-x:auto;border-radius:12px;}
table{width:100%;border-collapse:collapse;background: rgba(255,255,255,0.05);animation: fadeIn 0.8s ease forwards;}
table th,table td{padding:12px 10px;text-align:left;}
table th{background: rgba(79,163,255,0.2);}
table tr:nth-child(even){background: rgba(255,255,255,0.05);}
table tr:hover{background: rgba(79,163,255,0.2); transform:scale(1.02); transition:0.2s;}

/* Buttons */
table button, table form button{
  padding:6px 10px;
  border:none;
  border-radius:8px;
  margin-right:5px;
  background:#2563eb;
  color:#fff;
  cursor:pointer;
  transition:0.3s;
}
table button:hover, table form button:hover{
  background:#1d4ed8;
  box-shadow:0 0 8px #60a5fa;
}

/* Status Dots */
.status-dot{display:inline-block;width:10px; height:10px;border-radius:50%;margin-right:5px;}
.status-pending{background:#facc15; animation:pulse 1.5s infinite;}
.status-approved{background:#16a34a;}
.status-declined{background:#dc2626;}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.5);}}

/* Animations */
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* Hamburger */
.menu-btn{display:none;font-size:22px;cursor:pointer;margin-bottom:15px;color:#fff;position:fixed;top:15px;left:15px;z-index:1001;}
@media(max-width:768px){
  .menu-btn{display:block;}
  .sidebar{position:fixed;top:0;left:-260px;height:100%;width:240px;z-index:1000;}
  .sidebar.active{transform:translateX(260px);}
  .main-content{padding:15px;}
}
</style>
</head>
<body>

<i class="fas fa-bars menu-btn" id="menu-toggle"></i>

<div class="dashboard">
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <h2>Phantom Admin</h2>
    <a href="{{ url_for('admin_dashboard') }}">Dashboard</a>
    <a href="{{ url_for('admin_users') }}">Users</a>
    <a href="{{ url_for('admin_cases') }}">Cases</a>
    <a href="{{ url_for('admin_withdrawals') }}">Withdrawals</a>
    <a href="{{ url_for('admin_settings') }}">Settings</a>
    <form action="{{ url_for('admin_logout') }}" method="POST">
      <button type="submit">Logout</button>
    </form>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <h2>Withdrawal Requests</h2>

    <!-- Filter/Search -->
    <form method="GET" action="{{ url_for('admin_withdrawals') }}" style="margin-bottom:15px;">
      <input type="text" name="search" placeholder="Search by username" style="padding:5px 10px;border-radius:5px;">
      <select name="status" style="padding:5px 10px;border-radius:5px;">
        <option value="">All Statuses</option>
        <option value="Pending">Pending</option>
        <option value="Approved">Approved</option>
        <option value="Declined">Declined</option>
      </select>
      <button type="submit" style="padding:6px 12px;border-radius:6px;background:#2563eb;color:#fff;">Filter</button>
    </form>

    <!-- Withdrawal Table -->
    <div class="table-wrapper">
      <table>
        <tr>
          <th>ID</th>
          <th>User</th>
          <th>Amount</th>
          <th>Currency</th>
          <th>Status</th>
          <th>Requested At</th>
          <th>Actions</th>
        </tr>
        {% for withdrawal in withdrawals %}
        <tr>
          <td>{{ withdrawal.id }}</td>
          <td>{{ withdrawal.user.username }}</td>
          <td>{{ withdrawal.amount }}</td>
          <td>{{ withdrawal.currency }}</td>
          <td>
            <span class="status-dot {% if withdrawal.status=='Pending' %}status-pending{% elif withdrawal.status=='Approved' %}status-approved{% else %}status-declined{% endif %}"></span>
            {{ withdrawal.status }}
          </td>
          <td>{{ withdrawal.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
          <td>
            {% if withdrawal.status == 'Pending' %}
              <form method="POST" action="{{ url_for('approve_withdrawal', withdrawal_id=withdrawal.id) }}" style="display:inline;">
                <button type="submit">Approve & Notify</button>
              </form>
              <form method="POST" action="{{ url_for('decline_withdrawal', withdrawal_id=withdrawal.id) }}" style="display:inline;">
                <button type="submit">Decline & Notify</button>
              </form>
            {% else %}
              <form method="POST" action="{{ url_for('notify_withdrawal', withdrawal_id=withdrawal.id) }}" style="display:inline;">
                <button type="submit">Resend Notification</button>
              </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </table>
    </div>
  </div>
</div>

<script>
const menuToggle = document.getElementById('menu-toggle');
const sidebar = document.getElementById('sidebar');

menuToggle.addEventListener('click', () => {
  sidebar.classList.toggle('active');
});

// Click outside sidebar closes it on mobile
document.addEventListener('click', (e)=>{
  if(window.innerWidth <= 768 && sidebar.classList.contains('active')){
    if(!sidebar.contains(e.target) && e.target !== menuToggle){
      sidebar.classList.remove('active');
    }
  }
});
</script>

</body>
</html>
